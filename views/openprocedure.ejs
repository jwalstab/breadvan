<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.10/css/select2.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.10/js/select2.min.js"></script>

<style type="text/css">
    * {
        box-sizing: border-box;
      }
      
      body {
        background-color: #f1f1f1;
        padding: 20px;
        font-family: Arial;
      }
      
      /* Center website */
      .main {
        max-width: 1000px;
        margin: auto;
      }
      
      h1 {
        font-size: 50px;
        word-break: break-all;
      }
      
      .row {
        margin: 8px -16px;
      }
      
      /* Add padding BETWEEN each column (if you want) */
      .row,
      .row > .column {
        padding: 8px;
      }
      
      /* Create four equal columns that floats next to each other */
      .column {
        float: left;
        width: 33%;
      }
      
      /* Clear floats after rows */
      .row:after {
        content: "";
        display: table;
        clear: both;
      }
      
      /* Content */
      .content {
        background-color: white;
        padding: 10px;
      }

      .qtmpanel {
        background-color: lightgray;
        min-height: 600px;
        max-height: 600px;
        overflow: scroll;
      }
      
      /* Responsive layout - makes a two column-layout instead of four columns */
      @media screen and (max-width: 900px) {
        .column {
          width: 50%;
        }
      }
      
      /* Responsive layout - makes the two columns stack on top of each other instead of next to each other */
      @media screen and (max-width: 600px) {
        .column {
          width: 100%;
        }
      }
</style>

<div class="A4">
        <img style="float: left; margin: 0px 0px 0px 0px;" src="/img/sdslogo.jpg"/>
        <img style="float: right; margin: 0px 0px 0px 0px;" src="/img/idsmall.png"/>
        <br>
        <div style="text-align: center"><h2>Colonoscopy Report</h1></div>
        <br>
        <form action="/updateprocedure" method="POST">
                <h3>Details</h3>
                <label class="control-label">Procedure Date</label>
                <input type="text" id="pdate" style="width: 160px;" name="procedureDate" placeholder="<%= data.procedureDate %>">
                <label class="control-label">Patient ID</label>
                <input type="text" id="pid" style="width: 160px;" name="patientID" placeholder="<%= data.patientID %>">
                <label class="control-label">Proceduralist</label>
                <input type="text" id="pdate" style="width: 160px;" name="proceduralist" value="<%= data.proceduralist %>">
                <br><br>
                <label class="control-label">Reason for procedure</label>
                <input type="text" name="reason" placeholder="<%= data.reason %>" style="width: 500px; float: right;">
                <br>
                <br>
                <label class="control-label" rows="5" height =>Findings</label>
                <input type="text" name="findings" placeholder="<%= data.findings %>" cols="40" rows="5" style="width: 500px; float: right;"></textarea>
                <br><br>
                <label class="checkbox-inline">
                        <input type="checkbox" id="inlineCheckbox1" name="polyps" value="polyps"  <%= data.polyps ? "checked" : "" %>> Bowel Preparation
                        </label>
                        <label class="checkbox-inline">
                            <input type="checkbox" id="inlineCheckbox2" value="completecolon"<%= data.completecolon ? "checked" : "" %>> Complete Colonoscopy Achieved
                        </label>
                        <label class="checkbox-inline">
                            <input type="checkbox" id="inlineCheckbox3" value="haemorrhoids"<%= data.haemorrhoids ? "checked" : "" %>> Haemorrhoids
                        </label>
                        <label class="checkbox-inline">
                            <input type="checkbox" id="inlineCheckbox3" value="diverticulardisease"<%= data.diverticulardisease ? "checked" : "" %>> Diverticular Disease
                        </label>
                        <label class="checkbox-inline">
                            <input type="checkbox" id="inlineCheckbox3" value="colitis"<%= data.colitis ? "checked" : "" %>> Colitis
                        </label>
                    </label>
                    <br><br><br>
                    <div id = "img-container">
                        <canvas id="diagram-canvas"></canvas>
                        <img src ="/imgsrv/<%= data.procedureID %>/IMG0.JPG" id="img1" width="245" height="245">
                        <img src ="/imgsrv/<%= data.procedureID %>/IMG1.JPG" id="img2" width="245" height="245">
                        <img src ="/imgsrv/<%= data.procedureID %>/IMG2.JPG" id="img3" width="245" height="245">
                        <img src ="/imgsrv/<%= data.procedureID %>/IMG3.JPG" id="img4" width="245" height="245">
                        <img src ="/imgsrv/<%= data.procedureID %>/IMG4.JPG" id="img5" width="245" height="245">
                        <img src ="/imgsrv/<%= data.procedureID %>/IMG5.JPG" id="img6" width="245" height="245">
                    </div>
                    <br><br><br>
                    <label class="control-label">Follow up with doctor required:</label>
                    <label class="checkbox-inline">
                            <input type="radio" id="followupradio1" name="followupradio" <%= data.followupradio == "yes" ? "checked" : "" %> value="yes"> Yes
                            </label>
                            <label class="checkbox-inline">
                                <input type="radio" id="followupradio2" name="followupradio" <%= data.followupradio == "no" ? "checked" : "" %> value="no"> No
                            </label>
                        </label>
                        <br>
                        <label class="control-label">If yes, details:</label>
                        <input type="text" style="width: 460px;" name="followupdetails" placeholder="<%= data.followupdetails %>" >
                        <br>
                        <label class="control-label">Recommended timeframe for follow up colonoscopy:</label>
                        <input type="text" onclick="StartDate()" id="fdate" style="width: 160px;" name="fdate" placeholder="<%= data.fdate %>"><br>
                        <p>Or</p>
                        <input type="checkbox" id="inlineCheckbox2" value="followupdiscuss" name="followupdiscuss" <%= data.followupdiscuss == "yes" ? "checked" : "" %> > To be discussed at your follow up appointment
                        <br><br>
                        <p>Doctor signature:  ______________________________________</p>
                        <br><br>
                        <input type="hidden" name="imgdata" id="imgdatainput" value="">
                        <input type="hidden" name="procedureID" id="procedureID" value="<%= data.procedureID %>">
                        <button type="submit" style="float: right;" class="btn btn-theme">Submit</button>
        </form>
</div>


<script>
var imgToCheck = document.getElementById('img1');
console.log(imgToCheck);
if (imgToCheck.naturalWidth === 0) {
    console.log("dead pic");
}
else{
  console.log("pic ok")
}
</script>

<script>

    var canvas = document.getElementById("diagram-canvas");
    var context = canvas.getContext("2d");
    var clicking = false;

    //var img = new Image();
    //img.src="/img/diagram.png";
    //img.onload=function(){
    //    context.drawImage(img, 0, 0,canvas.width,canvas.height);
    //}
    window.addEventListener('mousemove', draw, false);
    window.addEventListener('mousedown', Clicking, false);
    window.addEventListener('mouseup', NotClicking, false);

    /*function imgdata(){
        var imgObj ={
            data: canvas.toDataURL()
        } 

        const options = {
            method: 'POST',
            body: JSON.stringify(imgObj),
            headers: {
                'Content-Type': 'application/json'
            }
        }
        fetch(APIURL + '/sendimagedata', options)
        .then(res => res.json())
        .then(res => console.log(res.msg));
    }*/
    function Clicking(e){
        clicking = true;
    }
    function NotClicking(e){
        var bla = 0;
        while(bla < 25000){
            bla++;
            if (bla == 24999){
                clicking = false;
                document.getElementById("imgdatainput").value = canvas.toDataURL();
                console.log(document.getElementById("imgdatainput").value);
            }
        }
    }
    function draw(e) {
        if (clicking){
            var pos = getMousePos(canvas, e);
            posx = pos.x;
            posy = pos.y;
            context.fillStyle = "#000000";
            context.fillRect(posx, posy, 1, 1);
        }
    }
    function getMousePos(canvas, evt) {
        var rect = canvas.getBoundingClientRect();
        return {
            x: (evt.clientX - rect.left) / (rect.right - rect.left) * canvas.width,
            y: (evt.clientY - rect.top) / (rect.bottom - rect.top) * canvas.height
        };
    }
</script>